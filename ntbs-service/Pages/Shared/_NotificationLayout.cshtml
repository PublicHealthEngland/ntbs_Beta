@model ntbs_service.Pages_Notifications.NotificationModelBase
@using static NHSUK.FrontEndLibrary.TagHelpers.GridColumnWidth
@{
    Layout = "../Shared/_Layout.cshtml";
    var splitUrlPath = Context.Request.Path.ToString().Split("/");
    var currentPage = splitUrlPath[splitUrlPath.Length-1];

    ViewData["IsOverviewPage"] = currentPage == "Overview";
    ViewData["IsPatientPage"] = currentPage == "Patient";
    ViewData["IsEpisodePage"] = currentPage == "Episode";
    ViewData["IsClinicalDetailsPage"] = currentPage == "ClinicalDetails";
    ViewData["IsContactTracingPage"] = currentPage == "ContactTracing";
    ViewData["IsSocialRiskFactorsPage"] = currentPage == "SocialRiskFactors";
    ViewData["IsTravelPage"] = currentPage == "Travel";
    ViewData["IsComorbiditiesPage"] = currentPage == "Comorbidities";
    ViewData["IsImmunosupressionPage"] = currentPage == "Immunosupression";
    ViewData["IsPreviousHistoryPage"] = currentPage == "PreviousHistory";
    ViewData["IsLinkedNotificationsPage"] = currentPage == "LinkedNotifications";

    var MainGridWidth = (bool)ViewData["IsLinkedNotificationsPage"] ? Full : ThreeQuarters;
}

<nhs-grid-row>
    <nhs-grid-column grid-column-width="Full">
        <partial name="./_NotificationBanner.cshtml" model="@Model"/>
    </nhs-grid-column>
    @if (!(bool)ViewData["IsLinkedNotificationsPage"])
    {
        <nhs-grid-column grid-column-width="OneQuarter">
            <div>
                <li class="@("contents-list-item " + ((bool)ViewData["IsPatientPage"] ? "contents-list-item--current" : ""))">
                    <a class="app-subnav__link govuk-link govuk-link--no-visited-state" href="@Model.Notification.PatientEditPath">Person details</a>
                </li>
                <li class="@("contents-list-item " + ((bool)ViewData["IsEpisodePage"] ? "contents-list-item--current" : ""))">
                    <a class="app-subnav__link govuk-link govuk-link--no-visited-state" href="@Model.Notification.EpisodeEditPath">Hospital details</a>
                </li>
                <li class="@("contents-list-item " + ((bool)ViewData["IsClinicalDetailsPage"] ? "contents-list-item--current" : ""))">
                    <a class="app-subnav__link govuk-link govuk-link--no-visited-state" href="@Model.Notification.ClinicalDetailsEditPath">Clinical Details</a>
                </li>
                <li class="@("contents-list-item " + ((bool)ViewData["IsContactTracingPage"] ? "contents-list-item--current" : ""))">
                    <a class="app-subnav__link govuk-link govuk-link--no-visited-state" href="@Model.Notification.ContactTracingEditPath">Contact Tracing</a>
                </li>
                <li class="@("contents-list-item " + ((bool)ViewData["IsSocialRiskFactorsPage"] ? "contents-list-item--current" : ""))">
                    <a class="app-subnav__link govuk-link govuk-link--no-visited-state" href="@Model.Notification.SocialRiskFactorsEditPath">Social Risk Factors</a>
                </li>
                <li class="@("contents-list-item " + ((bool)ViewData["IsTravelPage"] ? "contents-list-item--current" : ""))">
                    <a class="app-subnav__link govuk-link govuk-link--no-visited-state" href="@Model.Notification.TravelEditPath">Travel/visitor history</a>
                </li>
                <li class="@("contents-list-item " + ((bool)ViewData["IsComorbiditiesPage"] ? "contents-list-item--current" : ""))">
                    <a class="app-subnav__link govuk-link govuk-link--no-visited-state" href="@Model.Notification.ComorbiditiesEditPath">Co-morbidities</a>
                </li>
                <li class="@("contents-list-item " + ((bool)ViewData["IsImmunosupressionPage"] ? "contents-list-item--current" : ""))">
                    <a class="app-subnav__link govuk-link govuk-link--no-visited-state" href="@Model.Notification.ImmunosupressionEditPath">Immunosupression</a>
                </li>
                <li class="@("contents-list-item " + ((bool)ViewData["IsPreviousHistoryPage"] ? "contents-list-item--current" : ""))">
                    <a class="app-subnav__link govuk-link govuk-link--no-visited-state" href="@Model.Notification.PreviousHistoryEditPath">Previous History</a>
                </li>
            </div>
        </nhs-grid-column>
    }
    <nhs-grid-column grid-column-width=@MainGridWidth>
            <input type="hidden" asp-for="NotificationId" />
            @RenderBody()
    </nhs-grid-column>
</nhs-grid-row>

@section ActionsAside 
{
    <h2 class="govuk-heading-s" id="manage-notification-title">
        Manage Notification
    </h2>
    @if(Model.Notification.NotificationStatus == NotificationStatus.Draft)
    {
        <button nhs-button-type="Standard" asp-page-handler="Submit">Submit</button>
    }
    else if ((bool)ViewData["IsOverviewPage"])
    {
        <button nhs-button-type="Standard" asp-page-handler="CreateLink">New notification for this person</button>
    }
}
