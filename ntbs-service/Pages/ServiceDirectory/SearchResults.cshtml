@page "/ServiceDirectory/SearchResults/{handler?}"
@model ntbs_service.Pages.ServiceDirectory.SearchResults
@using static NHSUK.FrontEndLibrary.TagHelpers.FormGroupType

@{
    Layout = "Shared/_Layout";
}

<nhs-width-container container-width="Standard">
    <back-link-retaining-history inline-template>
        <nhs-back-link v-on:click="navigateBack" href="/ServiceDirectory">Back</nhs-back-link>
    </back-link-retaining-history>

    <h1 class="nhsuk-heading-xl">Search results</h1>
    <p>Search for a service or case manager</p>
    
    <div class="case-manager-search-keyword">
        <form method="get" autocomplete="off">
          @{
              var hasSearchKeywordError = !Model.IsValid("SearchKeyword");
              var searchKeywordGroupState = hasSearchKeywordError ? Error : Standard;
          } 
          <nhs-form-group nhs-form-group-type=@searchKeywordGroupState id="search-keyword">
              <span ref="errorField" nhs-span-type="ErrorMessage" id="search-keyword-error"
                    asp-validation-for="SearchKeyword" has-error="@hasSearchKeywordError">
              </span>
              <input is-error-input=@hasSearchKeywordError nhs-input-type="Standard" 
                  asp-for="SearchKeyword" fixed-width="Twenty">
          </nhs-form-group>
        </form>  
    </div>
    
    <div class="case-manager-results-summary">
        @{
            var resultCount = Model.CaseManagersSearchResults?.NumberOfResults ?? 0;
            var resultsFoundString = $"{resultCount.ToString()} Result{(resultCount == 1 ? "" : "s")} found";
        }
        <p> @resultsFoundString </p>
    </div>
    
    @if (Model.CaseManagersSearchResults != null)
    {
        <ol class="search-results-list" id="search-results">
            @foreach (var caseManager in @Model.CaseManagersSearchResults)
            {
                <li>
                    <!-- Each search hit is displayed using a notification banner -->
                    <div class="case-manager-search-result-container" id="search-result-item">
                        <a class="case-manager-search-result-name" href=@($"/ContactDetails/{caseManager.Username}")>
                             @caseManager.FullName
                        </a>
                        <nhs-summary-list classes="case-manager-search-result-item-summary" is-without-border="true">
                            @foreach (var tbService in caseManager.CaseManagerTbServices.Select(x => x.TbService))
                            {
                                <nhs-summary-list-row>
                                    <nhs-summary-list-row-key>Service:</nhs-summary-list-row-key>
                                    <nhs-summary-list-row-value>
                                        <span>
                                            <a href=@($"/ServiceDirectory/Region/{tbService.PHECCode}")>
                                               @tbService.PHEC?.Name
                                            </a>
                                            <span> > </span>
                                            <a href=@($"/ServiceDirectory/Region/{tbService.PHECCode}#{tbService.Code}")>
                                                @tbService.Name
                                            </a>
                                        </span>
                                    </nhs-summary-list-row-value>
                                </nhs-summary-list-row>
                            }
                            <nhs-summary-list-row>
                                <nhs-summary-list-row-key>Job Title:</nhs-summary-list-row-key>
                                <nhs-summary-list-row-value>@caseManager.JobTitle</nhs-summary-list-row-value>
                            </nhs-summary-list-row>
                        </nhs-summary-list>
                    </div>
                    
                </li>
            }
        </ol>
    }
    
    <nav class="nhsuk-pagination" role="navigation" aria-label="Pagination">
        <ul class="nhsuk-list nhsuk-pagination__list">
            <nhs-pagination next-link-text="@Model.CaseManagersSearchResults.NextPageText" 
                            next-url="@Model.NextPageUrl"
                            previous-link-text="@Model.CaseManagersSearchResults.PreviousPageText" 
                            previous-url="@Model.PreviousPageUrl">
            </nhs-pagination>
        </ul>
    </nav>
</nhs-width-container>