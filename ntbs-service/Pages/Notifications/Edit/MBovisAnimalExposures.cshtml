@page "/Notifications/{NotificationId:int}/Edit/MBovis/AnimalExposures/{handler?}"
@using ntbs_service.Models.Entities
@model ntbs_service.Pages.Notifications.Edit.MBovisAnimalExposuresModel
@using static NHSUK.FrontEndLibrary.TagHelpers.FormGroupType

@{
    Layout = "../../Shared/_NotificationEditLayout.cshtml";
    ViewData["Title"] = "Notification - M. bovis - Animal exposure";
    var fullValidation = Model.MBovisDetails.ShouldValidateFull ? "True" : "False";
}

<partial name="_SinglePageErrorSummaryPartial"/>

<h2> M. bovis - Animal exposure </h2>

<div>

    <hide-section-if-false inline-template>
        <div>
            <validate-input
                model="@nameof(MBovisDetails)"
                property="@nameof(MBovisDetails.HasAnimalExposure)"
                shouldvalidatefull="@fullValidation"
                v-on:valid="hideOrShowSection" 
                v-on:mounted="hideOrShowSection" 
                ref="inner-validate" 
                inline-template>
                @{
                    var hasAnimalExposureError = !Model.IsValid($"{nameof(MBovisDetails)}.{nameof(MBovisDetails.HasAnimalExposure)}");
                    var hasAnimalExposureGroupState = hasAnimalExposureError ? Error : Standard;
                    var hasAnimalExposureValues = Model.MBovisDetails.HasAnimalExposure == true && Model.MBovisDetails.MBovisAnimalExposures.Any();
                    var hasAnimalExposureDisabledText = hasAnimalExposureValues ? "Cannot modify value when records are logged against notification" : string.Empty;
                }

                <nhs-form-group nhs-form-group-type="@hasAnimalExposureGroupState" id="MBovisDetails-HasAnimalExposure">
                    <nhs-fieldset aria-describedby="has-exposure-error@(hasAnimalExposureValues ? " has-exposure-disabled" : string.Empty)" title="@hasAnimalExposureDisabledText">
                        <nhs-fieldset-legend nhs-legend-size="Standard">
                            @Html.DisplayNameFor(m => m.MBovisDetails.HasAnimalExposure)
                        </nhs-fieldset-legend>
                        @if (hasAnimalExposureValues)
                        {
                            <span id="has-exposure-disabled" class="govuk-visually-hidden">@hasAnimalExposureDisabledText</span>
                            <input type="hidden" asp-for="MBovisDetails.HasAnimalExposure"/>
                        }
                        <span nhs-span-type="ErrorMessage" ref="errorField" asp-validation-for="MBovisDetails.HasAnimalExposure" has-error="@hasAnimalExposureError" id="has-exposure-error"></span>
                        <nhs-radios nhs-radios-type="Standard" v-on:change="validate">
                            <nhs-radios-item>
                                <input nhs-input-type="Radios" asp-for="MBovisDetails.HasAnimalExposure" id="has-exposure-yes" type="radio" value="true" disabled="@hasAnimalExposureValues"/>
                                <label nhs-label-type="Radios" for="has-exposure-yes">Yes</label>
                            </nhs-radios-item>
                            <nhs-radios-item>
                                <input nhs-input-type="Radios" asp-for="MBovisDetails.HasAnimalExposure" id="has-exposure-no" ref="conditional-false" type="radio" value="false" disabled="@hasAnimalExposureValues"/>
                                <label nhs-label-type="Radios" for="has-exposure-no">No</label>
                            </nhs-radios-item>
                        </nhs-radios>
                    </nhs-fieldset>
                </nhs-form-group>
            </validate-input>

            <div ref="conditional-section">
                @{
                    ViewData["ShowMBovisAnimalExposureEditLinks"] = true;
                }
                <partial name="Shared/_MBovisAnimalExposureTable" for="Notification.MBovisDetails.MBovisAnimalExposures"/>

                <button id="add-new-button"
                        nhs-button-type="Standard"
                        classes="ntbsuk-button--primary"
                        name="actionName"
                        value="Create">
                    Add New
                </button>
            </div>
        </div>
    </hide-section-if-false>
</div>