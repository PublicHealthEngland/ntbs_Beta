@page "/Notifications/{id:int}/Edit/PreviousHistory/{handler?}"
@model ntbs_service.Pages.Notifications.Edit.PreviousHistoryModel
@using static NHSUK.FrontEndLibrary.TagHelpers.FormGroupType

@{
    Layout = "../../Shared/_NotificationLayoutWithAlertsAndSideMenu.cshtml";
    ViewData["Title"] = "Notification - Patient TB History";
    var fullValidation = Model.PatientTbHistory.ShouldValidateFull ? "True" : "False";
}

<h2>Previous History for New Patient</h2>

<div>
    <div asp-validation-summary="ModelOnly" class="text-danger"></div>

    <nhs-form-group nhs-form-group-type="Standard">
        <nhs-fieldset>
            <nhs-fieldset-legend nhs-legend-size="Standard"> The patient has had TB in the past </nhs-fieldset-legend>
            <div class="nhsuk-radios govuk-radios--conditional" data-module="govuk-radios">
                <div class="nhsuk-radios__item">
                    <input asp-for="PatientTbHistory.NotPreviouslyHadTB" class="nhsuk-radios__input" type="radio" value="false" id="previous-tb-yes" 
                           data-aria-controls="conditional-previously-had-tb-conditional">
                    <label class="nhsuk-label nhsuk-radios__label" for="previous-tb-yes">
                        Yes
                    </label>
                </div>

                <div class="govuk-radios__conditional govuk-radios__conditional--hidden" id="conditional-previously-had-tb-conditional">
                    <validate-input model="PreviousHistory" property="PreviousTBDiagnosisYear" shouldvalidatefull="@fullValidation" inline-template>
                        @{
                            var hasPreviousTbDiagnosisError = !Model.IsValid("PatientTBHistory.PreviousTBDiagnosisYear");
                            var previousTbDiagnosisGroupState = hasPreviousTbDiagnosisError ? Error : Standard;
                        }
                        <nhs-form-group nhs-form-group-type="@previousTbDiagnosisGroupState">
                            <label nhs-label-type="Standard" asp-for="PatientTbHistory.PreviousTBDiagnosisYear"> Year of diagnosis </label>
                            <span nhs-span-type="ErrorMessage" id="previous-tb-diagnosis-year-error" ref="errorField"
                                  asp-validation-for="PatientTbHistory.PreviousTBDiagnosisYear" has-error="@hasPreviousTbDiagnosisError"></span>
                            <input ref="inputField" v-on:blur="validate" is-error-input=@hasPreviousTbDiagnosisError
                                   nhs-input-type="Standard" fixed-width="Four" asp-for="PatientTbHistory.PreviousTBDiagnosisYear">
                        </nhs-form-group>
                    </validate-input>
                </div>

                <div class="nhsuk-radios__item">
                    <input asp-for="PatientTbHistory.NotPreviouslyHadTB" class="nhsuk-radios__input" type="radio" value="true" id="previous-tb-no">
                    <label class="nhsuk-label nhsuk-radios__label" for="previous-tb-no">
                        No
                    </label>
                </div>
            </div>
        </nhs-fieldset>
    </nhs-form-group>

    <br />
    <partial name="_PaginationPartial" for="Notification" />

</div>
